<?php
  # given a shipment ID and assuming MID is not initialized when the shipment is created

  function setShipmentToInTransit($SID, $db){
    require_once("./randomManufacturer.php");
    require_once("./randomWarehouse.php");
    require_once("./Dijkstras.php");
    $err = "Could not run query: ";
    $success = " record updated successfully!";
    $adjacencyMatrix = array(
             /*AL*/ array(0, 0, 0, 0, 0, 0, 0, 0, 181, 135, 0, 0, 0, 0, 0, 0, 429, 0, 0, 0, 0, 0, 0, 799, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 276, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*AK*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1295, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1075, 0, 0, 0, 0, 0, 0, 0, 0, 0, 909, 0, 0, 0 ),
             /*AZ*/ array(0, 0, 0, 0, 612, 609, 0, 0, 0, 0, 2868, 724, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 569, 0, 0, 426, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 486, 0, 0, 0, 0, 0, 0 ),
             /*AR*/ array(0, 0, 0, 0, 0, 749, 0, 0, 0, 0, 0, 0, 0, 0, 0, 383, 0, 282, 0, 0, 0, 0, 0, 180, 276, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 292, 0, 0, 0, 0, 0, 366, 402, 0, 0, 0, 0, 0, 0, 0 ),
             /*CA*/ array(0, 0, 612, 0, 0, 0, 0, 0, 0, 0, 2441, 433, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128, 0, 0, 0, 0, 0, 0, 0, 0, 427, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*CO*/ array(0, 0, 609, 749, 0, 0, 0, 0, 0, 0, 0, 683, 0, 0, 0, 483, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 431, 0, 0, 0, 281, 0, 0, 0, 0, 474, 0, 0, 0, 0, 0, 0, 0, 379, 0, 0, 0, 0, 0, 138),
             /*CT*/ array(0, 0, 0, 0, 0, 0, 0, 210, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 0, 0, 0, 0, 0, 0, 0, 0, 125, 0, 86, 0, 0, 0, 0, 0, 0, 52, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
             /*DE*/ array(0, 0, 0, 0, 0, 0, 210, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 87, 0, 0, 0, 0, 0, 0, 0, 0, 0, 87, 0, 0, 0, 0, 0, 0, 0, 87, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*FL*/ array(181, 0, 0, 0, 0, 0, 0, 0, 0, 207, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*GA*/ array(135, 0, 0, 0, 0, 0, 0, 0, 207, 0, 0, 0, 0, 0, 0, 0, 345, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 186, 0, 236, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*HI*/ array(0, 0, 2868, 0, 2441, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*ID*/ array(0, 1295, 724, 0, 433, 683, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 285, 0, 317, 0, 0, 0, 0, 0, 0, 0, 0, 357, 0, 0, 0, 0, 0, 0, 331, 0, 0, 402, 0, 0, 630 ),
             /*IL*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 161, 252, 0, 0, 0, 0, 0, 0, 0, 0, 0, 176, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 264, 0, 0, 0, 0, 0, 0, 276, 0 ),
             /*IN*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 161, 0, 0, 0, 128, 0, 0, 0, 0, 232, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 214, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*IA*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 252, 0, 0, 174, 0, 0, 0, 0, 0, 0, 207, 0, 214, 0, 172, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 412, 0, 0, 0, 0, 0, 0, 0, 247, 0 ),
             /*KS*/ array(0, 0, 0, 383, 0, 483, 0, 0, 0, 0, 0, 0, 0, 0, 174, 0, 0, 0, 0, 0, 0, 0, 0, 0, 176, 0, 87, 0, 0, 0, 616, 0, 0, 0, 0, 297, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*KY*/ array(429, 0, 0, 0, 0, 0, 0, 0, 0, 345, 0, 0, 0, 128, 0, 0, 0, 0, 0, 435, 0, 0, 0, 0, 435, 0, 0, 0, 0, 0, 0, 0, 392, 0, 128, 0, 0, 0, 0, 0, 0, 176, 0, 0, 0, 389, 0, 163, 0, 0 ),
             /*LA*/ array(0, 0, 0, 282, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 624, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 358, 0, 0, 0, 0, 0, 0, 0 ),
             /*ME*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 171, 0, 0, 0, 0, 0, 0, 0, 121, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*MD*/ array(0, 0, 0, 0, 0, 0, 0, 87, 0, 0, 0, 0, 0, 0, 0, 0, 435, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 138, 0, 0, 0, 0, 0, 0, 0, 88, 0, 272, 0, 0 ),
             /*MA*/ array(0, 0, 0, 0, 0, 0, 86, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 171, 0, 0, 0, 0, 0, 0, 0, 0, 0, 69, 0, 0, 102, 0, 0, 0, 0, 0, 0, 69, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*MI*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 232, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 232, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*MN*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 207, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 368, 0, 0, 0, 0, 0, 0, 347, 0, 0, 0, 0, 0, 0, 0, 212, 0 ),
             /*MS*/ array(799, 0, 0, 180, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 624, 0, 0, 0, 0, 0, 0, 429, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 358, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*MO*/ array(0, 0, 0, 276, 0, 0, 0, 0, 0, 0, 0, 0, 176, 0, 214, 176, 435, 0, 0, 0, 0, 0, 0, 429, 0, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 346, 0, 0, 0, 0, 0, 358, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*MT*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 285, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 575, 0, 0, 0, 0, 0, 0, 601, 0, 0, 0, 0, 0, 0, 0, 0, 528 ),
             /*NE*/ array(0, 0, 0, 0, 0, 431, 0, 0, 0, 0, 0, 0, 0, 0, 172, 87, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 344, 0, 0, 0, 0, 0, 0, 0, 0, 425 ),
             /*NV*/ array(0, 0, 569, 0, 128, 0, 0, 0, 0, 0, 0, 317, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 402, 0, 0, 0, 0, 0, 0, 431, 0, 0, 0, 0, 0, 0 ),
             /*NH*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 121, 0, 69, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 85, 0, 0, 0, 0, 0 ),
             /*NJ*/ array(0, 0, 0, 0, 0, 0, 125, 87, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 147, 0, 0, 0, 0, 0, 105, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*NM*/ array(0, 0, 423, 0, 0, 281, 0, 0, 0, 0, 0, 0, 0, 0, 0, 616, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 452, 0, 0, 0, 0, 0, 0, 579, 476, 0, 0, 0, 0, 0, 0 ),
             /*NY*/ array(0, 0, 0, 0, 0, 0, 86, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 102, 0, 0, 0, 0, 0, 0, 0, 0, 147, 0, 0, 0, 0, 0, 0, 0, 208, 0, 0, 0, 0, 0, 0, 147, 0, 0, 0, 0, 0 ),
             /*NC*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 392, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 184, 0, 455, 0, 0, 0, 149, 0, 0, 0, 0 ),
             /*ND*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 368, 0, 0, 575, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 138, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*OH*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 214, 0, 0, 128, 0, 0, 0, 0, 232, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 327, 0, 0, 0, 0, 0, 0, 0, 0, 0, 87, 0, 0 ),
             /*OK*/ array(0, 0, 0, 292, 0, 474, 0, 0, 0, 0, 0, 0, 0, 0, 0, 297, 0, 0, 0, 0, 0, 0, 0, 0, 346, 0, 0, 0, 0, 0, 452, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 345, 0, 0, 0, 0, 0, 0, 0 ),
             /*OR*/ array(0, 0, 0, 0, 427, 0, 0, 0, 0, 0, 0, 357, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 402, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 212, 0, 0, 0 ),
             /*PA*/ array(0, 0, 0, 0, 0, 0, 0, 87, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 138, 0, 0, 0, 0, 0, 0, 0, 0, 0, 105, 0, 208, 0, 0, 327, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 214, 0, 301, 0, 0 ),
             /*RI*/ array(0, 0, 0, 0, 0, 0, 52, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 69, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*SC*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 186, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 184, 0, 0, 0, 0, 0, 0, 0, 0, 314, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*SD*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 412, 0, 0, 0, 0, 0, 0, 0, 347, 0, 0, 601, 344, 0, 0, 0, 0, 0, 0, 138, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 290 ),
             /*TN*/ array(276, 0, 0, 366, 0, 0, 0, 0, 0, 236, 0, 0, 264, 0, 0, 0, 176, 0, 0, 0, 0, 0, 0, 358, 358, 0, 0, 0, 0, 0, 0, 0, 455, 0, 0, 0, 0, 0, 0, 314, 0, 0, 0, 0, 0, 504, 0, 0, 0, 0 ),
             /*TX*/ array(0, 0, 0, 402, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 358, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 579, 0, 0, 0, 0, 345, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*UT*/ array(0, 0, 486, 0, 0, 379, 0, 0, 0, 0, 0, 331, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 431, 0, 0, 476, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 374 ),
             /*VT*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 85, 0, 0, 147, 0, 0, 0, 0, 0, 0, 213, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*VA*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 389, 0, 0, 88, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 149, 0, 0, 0, 0, 0, 0, 0, 0, 504, 0, 0, 0, 0, 0, 229, 0, 0 ),
             /*WA*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 402, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 212, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*WV*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 163, 0, 0, 272, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 87, 0, 0, 301, 0, 0, 0, 0, 0, 0, 0, 229, 0, 0, 0, 0 ),
             /*WI*/ array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 276, 0, 247, 0, 0, 0, 0, 0, 0, 0, 212, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ),
             /*WY*/ array(0, 0, 0, 0, 0, 138, 0, 0, 0, 0, 0, 630, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 528, 425, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 290, 0, 0, 374, 0, 0, 0, 0, 0, 0 )
           );


    # Call randomManufacturer(), update current address
    $manufacturer = randomManufacturer($db);
    if($updateManuf=$db->prepare("UPDATE shipments SET MID = '$manufacturer[0]',
        cur_street = '$manufacturer[1]', cur_city = '$manufacturer[2]',
        cur_state = '$manufacturer[3]', cur_zip = '$manufacturer[4]' WHERE SID = $SID")){
          $updateManuf->execute();
          $updateManuf->close();
          echo "<br>manufacturer" . $success;
    } else echo "<br>" . $err . " update manufacturer";

    # Call randomWarehouse(), update the to address
    $warehouse = randomWarehouse($db);
    if($updateWare=$db->prepare("UPDATE shipments SET WID = '$warehouse[0]',
        to_street = '$warehouse[1]', to_city = '$warehouse[2]',
        to_state = '$warehouse[3]', to_zip = '$warehouse[4]' WHERE SID = $SID")){
          $updateWare->execute();
          $updateWare->close();
          echo "<br>warehouse" . $success;
    } else echo "<br>" . $err . " update warehouse";

    # manu[5] is closest_WID
    $startVertex = $manufacturer[5];
    $endVertex = $warehouse[0];
    # get the shortest path, save to remaining_nodes
    $output = dijkstra($adjacencyMatrix, $startVertex, $endVertex);

    if($updateDist=$db->prepare("UPDATE shipments SET remaining_nodes = '$output',
        status = '1' WHERE SID = $SID")){
        $updateDist->execute();
        $updateDist->close();
        echo "<br>remaining_nodes, status" . $success;
    } else echo "<br>" . $err . " remaining_nodes, in-transit";
  }
?>
